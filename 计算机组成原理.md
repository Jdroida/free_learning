# 计算机组成原理

## 基本概念

### 冯诺依曼

运算器，输入设备，输出设备，存储器，控制器。其余四个逻辑模块都要与控制器传输状态信息。
cpu由运算器和控制器组成。运算器主要负责算术运算和逻辑运算组成，由alu（算数逻辑单元）组成。

### 数字代码

电平信号：高电平表示1 低电平表示0
脉冲信号：有脉冲表示1 无脉冲表示0
优点：物理上易于实现和存储；抗干扰，可靠；数值范围大，精度高；可表示的信息类型广泛；数字逻辑进行处理
源码就是只关注符号位，正数的反码就是自己，负数的反码符号位是1，数值位按位取反。正数的补码就是自己，负数的补码就是符号位仍然为1，数值位按位取反再加一。
正数的移码就是源码符号位取反，负数的移码就是源码连同符号位一起取反，末位再加一
浮点数的尾数规格化，导致精度有所缺失（所以浮点数在编程里一般都是比较大小）

### 发展历史

1946-1957：电子管器件，速度低体积大价格贵不可靠
1958-1964：晶体管器件，体积小可靠，可用于数据处理
1965-1971：中小规模集成电路器件，更小体积更强算力，拓展到民用领域
1971至今：超大规模集成电路器件，微型计算机出现

### 性能指标

基本字长：一次数据操作的基本位数
外频：系统时钟频率
带宽：位宽*工作频率/8，表示单位时间内数据的传输量
内存：可编址的存储单元个数*存储单元的位宽

## 总线与IO系统

总线：连接各功能部件并承载信息传送
（分时共享）
IO接口：主机和外设的衔接部分。基本功能是设备寻址（接受cpu的地址码选择接口中的寄存器供cpu访问）与数据缓冲（实现主机与外设的速度匹配）
PCI总线（外围组件互联）：高性能同步总线，地址信号和数据信号复用

### IO接口分类

- 按数据传送格式

  串行接口：接口与外设一侧串行传送（传的远）
  并行接口：接口两侧均并行传输数据（传的近）

- 按时序控制

  同步接口与异步接口（接口与系统总线的信息传送）

- 操作控制方式

  PIO接口
  中断接口
  DMA接口
  IOP/PPU接口

### 总线结构

- 单总线结构

  部件之间信息交互的唯一通路

- 多总线结构

### 总线设计要素

- 带宽与传输模式
- 控制方式

  同步总线：统一的时序信号控制总线上的传送操作
  异步总线：无固定的时钟周期划分，总线周期由传送的实际需要决定，异步应答方式控制总线传送操作

- 仲裁方式

  解决总线控制权的争夺问题。

### 中断方式与接口

- 软硬件组织

	- 软件

	  中断服务程序，中断向量表（通过中断向量表找到程序地址，然后在软件层面操作）

	- 硬件

	  接口方面：请求，屏蔽，传递，判优等逻辑
	  cpu：对中断请求的响应逻辑

- 中断的全过程

  产生中断：外设有中断请求需要；该中断没有被屏蔽
  传送中断请求：使用单独请求线；公共请求线；混合方式传送

	- CPU对中断请求的响应

		- 响应条件

		  有未被屏蔽的中断请求到达；
		  cpu处于开中断模式；
		  中断源优先级比当前程序优先级更高；
		  cpu刚执行完一条指令

		- 形成中断服务程序入口地址

		  取决于中断方式
		  向量中断：将所有中断源的中断服务程序入口地址组织在公共查询程序中，cpu执行此查询程序确定入口地址
		  非向量中断：将入口地址组织在中断向量表中，cpu由硬件产生向量地址，再根据中断向量表查询程序入口地址

	- 中断的响应过程

	  执行中断隐指令——中断服务程序

### DMA与磁盘接口

DMA（直接内存权限）直接依靠硬件系统控制主存与外设之间的数据传送，无需cpu干预，传送之后以中断方式通知CPU。

- DMA数据传送模式

  单字传送，成组连续传送。区别在于每次分配的总线周期数量。

- DMA传送操作过程

  空闲——已请求——接管——读——写——判别。
  读写操作不能在一个时钟周期完成的话就进入延长阶段。
  判别之后单字传送方式会回到空闲状态，成组传送方式会回到接管状态。

### iop与ppu模式

iop：输入输出处理器
ppu：外围处理单元

- 通道类型

  选择型通路（单路），多路型通道。多路型通道又分为字节多路型和数组多路型。都可以连接多路外设每个通路仅连接一个外设。区别在于字节多路型每次只传输一个字节，数组多路型每次连续传输多个字节（定长数据块）。

- 通道结构与工作原理

  连接系统总线接口与IO总线接口，核心是通道控制器。
  通道的工作过程：
  1.程序提出io请求，cpu响应后组织通道程序并存储到主存，保存首地址（caw）和数据传输量
  2.初始化通道和设备号，发出启动命令
  3.通道接收启动命令，读取caw
  4.通道对外设寻址，连接到外设
  5.读取通道程序首条ccw，启动外设
  6.继续执行ccw控制io操作，更新cswr
  7.io结束，通道发出结束命令，中断请求，将cswr保存到主存单元
  8.cpu响应中断，切换到服务程序进行io善后管理

## CPU

### 主要部件

时序系统，控制部件，缓存部件，寄存器，运算部件

### 指令

CISC（复杂指令集）与risc（精简指令集）。简单指令（约占20%）约占80%使用频率。简单指令数量多，长度可以不固定，指令格式和寻址方式多样。
指令格式分为操作码+地址码/操作数。

### 寻址方式

立即寻址：指令中包含操作数
直接寻址：指令中给出操作数的地址码。包含主存直接寻址和寄存器直接寻址。
间接寻址：指令给出操作数的间接地址，包含存储单元地址或者寄存器编号
变址寻址：指令给出一个寄存器号和一个地址量，寄存器内容与地址和为有效地址
基址寻址：指令给出一个寄存器号和一个地址量，寄存器内同与地址量之和为有效地址。与变址寻址的区别在于，变址寻址是指令提供基准量寄存器提供偏移量，基址寻址是指令提供偏移量寄存器提供基准量
pc相对寻址：指令给出偏移量，pc当前值（程序指针寄存器）（隐含指定）与偏移量相加得到有效地址
页面寻址：指令给出位移量，pc高位部分与位移量拼接，形成有效地址

### mips32指令集

按字节编址，可用寄存器32个，位宽32位，risc架构。
单周期cpu：指令固定在一个时钟周期内完成，时间效率低，时钟宽度由单指令最长时间决定
多周期cpu：指令分散在多个时钟周期内完成，时钟宽度由单步最长时间决定
（数据通路设计不在这做笔记）
（控制系统设计不在这做笔记）

### 流水技术

指令过程分解为若干子过程，每个子过程都可以在专用功能段上与其他子过程重叠执行

## 校验算法

### 奇偶校验

在原始码流后面加上校验位，校验位只有一位。偶校验就是加上校验位之后有偶数个1，奇校验就是加上校验位之后有奇数个1.奇偶校验只能检测出奇数个错误

### 海明校验

带分组的奇偶校验，不止能检测出错误还能检测出错误的位置

### 循环冗余校验

假设信息码字为11100011，生成多项式
G(X)=X^5+X^4+X+1，计算CRC码字。

G(X) = X^5+X^4+X+1,也就是110011，因为最高次是5，所以，在信息码字后补5个0，变为1110001100000。用1110001100000模二除法除以110011，余数为11010，即为所求的冗余位。
因此发送出去的CRC码字为原始码字11100011末尾加上冗余位11010，即 1110001111010。接收端收到码字后，采用同样的方法验证，即将收到的码字用模二除法除以110011（是G(X)对应的二进制生成码），发现余数是0，则认为码字在传输过程中没有出错。

## 存储子系统

层次结构：CPU（cache）（L1-L2-L3）-主存-外存
内存主要存档CPU当前使用的指令和数据，可以随机访问（访问地址和访问时间没有关系），工作速度快，有足够的存储容量

### 按存储介质分类

- 半导体存储器

  静态存储器和动态存储器（主存）
  动态存储器需要刷新，定期向电容补充电荷。重写是破坏性读出后的自动操作，刷新与读写操作无关。

- 光盘存储器

  原理：用激光照射存储介质，使其发生物理化学变化，据此记录信息

- 磁表面存储器

  利用磁层上不同方向的磁化区域表示信息，容量大，非破坏性读出，长期保存信息，速度慢（外存）
  存储介质：磁层材料
  写入方式：不归零1制：写0电流不变，写1电流翻转。调频制：每次起始处写入电流跳变1次，以作为同步信号，在中间位置写0则不变写1则跳变

	- 信息分布

	  盘组：多个盘片，双面记录
	  圆柱面：各记录面上相同序号的磁道构成一个圆柱面（柱面数=/道数/面）
	  数据块：扇区（定长记录格式）+记录块（不定长记录格式）

	- 寻址路径

	  驱动器号——圆柱面号——磁头号——扇区号——字节序号

### 技术指标

- 存取时间
- 存取周期

  存取时间+恢复期

- 数据传输率

  单位时间内输入或者读出数据的量

### cache替换算法

最不经常使用（LFU）：将一段时间内被访问次数最少的部分从cache中置换出去
近期最久未使用（LRU）：将近期内最久违背访问过的cache块置换出去
随机置换：随机确定将哪块cache置换出去

## io设备

### 键盘及其接口

触点式，无触点式，虚拟式。键盘扫描程序包含逐行骚猫，行列扫描。

### 显示设备及接口

显示方式：字符方式（以字符为显示单位），图像模式（以像素为显示单位）

*XMind: ZEN - Trial Version*