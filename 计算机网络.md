# 计算机网络

## 分组交换的特点

### 对比报文交换

- 对路由器需要的缓存要求更低
- 传输速度更快且路由节点越多越明显

### 对比电路交换

- 允许更多用户同时使用网络
- 电路交换是独占，更快更稳

## 网络参考模型

### OSI参考模型

- 数据封装（地址，差错检验编码，协议控制）
- 物理层通信模式（单工 半双工 全双工）
- 数据链路层

	- 解决物理层直接相连的直接相邻节点传输问题
	- 方式：组帧，物理寻址
	- 原理：流量控制，差错控制，访问控制

- 网络层

	- 负责源主机到目的主机的数据分组交付
	- 全局唯一逻辑地址
	- 路由与分组转发

- 传输层

	- 分段和重组
	- SAP寻址（端口号)
	- 连接控制，流量控制，差错控制

- 会话层

	- 对话控制
	- 数据流中插入同步点（存档）

- 表示层

	- 数据表示转化（处理系统间交换信息的语法和语义）
	- 数据的加解密，压缩解压缩

- 应用层

### tcp/ip参考模型

- 应用层 传输层 网际层 网络接口层
- 所有结构都基于IP（网际层）之上

### 五层参考模型（实际应用）

- 应用层 传输层 网络层 数据链路层 物理层

## 网络性能指标

### 速率（比特率）（一般是额定速率）（发送速度）

### 带宽（数字信道所能传输的最大数据率）（传输速度）

### 延迟和丢包

- 节点处理
- 排队延迟（和流量强度有关）
- 传输延迟（和分组长度、链路带宽有关）
- 传播延迟（和物理长度、传播速度有关）
- 队列缓存有限，分组到达已满队列即被丢弃
- 时延带宽积（传播时延*带宽）（以比特位单位的链路长度）

### 吞吐量（发送端到接收端的速率）

## 数据链路层

### 组帧

封装数据报构成数据帧，加首部和尾部
帧同步

### 链路接入

解决共享介质的信道接入问题
标识MAC地址

### 相邻节点可靠交付

流量控制，差错检测，差错纠正
（确认码，重传之类的）
有很多检错纠错机制，不细说了

- 差错编码

  基本原理：增加冗余比特作为差错检测

- 汉明距离

  检错码的一种标准

- 循环冗余校验码

### 多路访问控制（MAC）协议

链路分为点对点链路和广播链路

### mac地址

mac地址是唯一的，出厂就定下来的，IP是有区域划分的，依赖于节点连接到哪个子网

- arp地址解析协议

  其实就是IP地址和mac地址的映射关系，具体算法不细究

### 以太网

造价低廉，应用广泛，满足网络速率要求，局域网的无冕之王

- 交换机

  存储转发以太网帧，即插即用，自学习（无需配置），多端口同时传输，还是全双工。
  交换表是照着MAC地址来，路由表是照着IP地址来。交换机是发的数据帧，路由器发的是IP数据报。

### PPP协议

点对点数据链路控制，无需介质访问控制

### 无线局域网（802.11）

IEEE802.11标准就是WiFi。802.11b是早期标准，最高11mbps，2.4ghz免费频段
基站（base station)=访问点（ap，access point）,基本服务集（bss）=AP+无线主机

## 网络层

网络层已经不是端到端协议了，每个主机和路由器都有网络层协议。

### 转发和路由

转发表确定路由器如何转发分组
路由确定分组从源到目的经过的路径

- 链路状态路由算法（迪杰斯特拉）
- 距离向量路由算法（动态规划）
- 路由信息协议（rip）

  最常见的AS内部路由协议（自治系统）

- OSPF（开放最短路径优先）

  开放的，采用链路状态路由
  相比于RIP的优点：安全，允许多条相同消耗路径

- BGP（边界网关协议）

  事实上的标准域间路由协议
  基于策略路由

### 虚电路网络

属性：连接服务网络。udp属于无连接服务网络（传输层），事先不确定路由路径
定义：一条从源主机到目的主机类似于电路的路径（逻辑连接）
和电路交换的区别：分组交换，每个分组利用全部带宽

- 组成

  从源主机到目的主机的一条路径
  虚电路号，沿路每段链路一个编号
  沿路每个网络层设备，利用转发表记录经过的每条虚电路

- 虚电路信令协议

  目前的Internet不采用

### 数据报网络

网络层无连接
每个分组携带目的地址
最长前缀匹配优先
其实就是现在的Internet网络

- IP数据报格式（Internet网络层）

	- 头部

		- 固定部分

		  版本号（ipv4/ipv6)+首部长度+服务类型+生存时间（ttl）（跳步数）+协议（tcp/udp）+首部校验和+源IP地址+目的IP地址
		  分组相关：标识ID+标志位（dont fragment和more fragment，表示路由器是否允许分片）+片偏移

		- 可变部分

		  选项字段（安全，时间戳，路有记录之类的）+填充

	- 数据

- IP分片

	- 最大传输单元（mtu）

	  大IP分组向较小mtu链路转发时可以被分片

- IP编址

  IP地址：32比特（ipv4）

	- 网络号（高比特位）

	  ip子网：具有相同网络号的设备接口，不跨越路由器可以彼此物理联通的接口

	- 主机号（低比特位）
	- 有类编址

	  规定网络号和主机号分别占多少位

		- A类地址

		  8位网络号+24位主机号
		  0.0.0.0-127.255.255.255
		  0开头（二进制）

		- B类地址

		  16位网络号+16位主机号
		  128.0.0.0-191.255.255.255
		  10开头（二进制）

		- C类地址

		  24位网络号+8位主机号
		  192.0.0.0-223.255.255.255
		  110开头（二进制）

		- D类地址，E类地址

		  不区分网络号和主机号，用来标识一组主机。D类是1110开头，E类是1111开头。

		- 注意一下特殊IP地址

	- 无类域间路由

	  不划分ABCD类地址界限
	  a.b.c.d/x
	  x表示网络前缀长度

	- 子网掩码

	  将主机号的一部分划分为子网号
	  IP分组的目的地址 与子网掩码按位与运算提取子网地址

	- 路由聚合（路由器把子网连接起来）
	- 获取IP地址

		- 静态配置
		- 动态获取（DHCP）

		  从服务器动态获取IP地址，子网掩码，网关地址，dns服务器名称和IP地址，允许地址复用

		- 网络地址转换（nat）

		  互联网上的ipv4不咋够了，得用私有地址。一堆内部网络公用一个ipv4。本地ip变更无需告知外界。
		  （感觉nat和DHCP应该都是搭配使用的）

	- ipv6

	  固定40字节基本首部，不允许分片

- 互联网控制报文协议（icmp）

  差错报告，网络探寻

## 传输层

在不同host上提供逻辑通信机制。传输层和网络层都提供逻辑通信机制，但是网络层提供主机之间，传输层提供应用进程之间逻辑通信机制。位于网络层之上，依赖于网络层。

### TCP与udp简述

tcp的优势：面向连接，可靠的传输，流量控制，拥塞控制。
udp的优势：无需建立连接，实现简单，头部开销小，没有拥塞控制，更好的控制发送时间和速率
二者都不提供延迟保障，最小带宽保障。

- TCP连接管理

	- 三次握手

	  客户端发送SYN报文段。不携带数据段，含有初始序列号seq
	  服务端发回SYNACK，分配buffer
	  客户端收到synack，回复ack segment，包含数据

	- 四次挥手

	  client向server发送tcp fin控制segment
	  server收到fin 回复ack 关闭连接 发送fin
	  client收到fin 回复ack 进入等待阶段
	  server收到ack 连接关闭

### 多路复用和多路分用机制

多路复用：发送端，从多个socket接收数据，为每块数据封装头部信息，生成segment交给网络层
多路分用：接收端，传输层依据头部信息将接收到的segment交给正确的socket
TCP在多路复用/分用的时候用的是四元组，UDP是用的二元组。

### 可靠数据传输机制（rdt）

校验字和+序列号+ACK+重复分组。rdt3.0效率太低，引入缓存分组。

- 滑动窗口协议

  窗口：允许使用到的序列号范围
  滑动窗口：随着协议的运行，窗口再序列号空间内向前滑动

	- GBN协议

	  go back n 后退N帧协议
	  接收方扩展FSM（状态机）
	  可能产生重复ACK
	  直接丢弃乱序到达的分组
	  发送方从没接收到ACK的帧开始重发
	  累计确认：最大的确认帧表示这个帧和以前的帧都已经被确认了

	- SR协议

	  selective repeat
	  GBN的缺陷：重传分组太多
	  SR为每一个分组设置定时器
	  接收方对每个分组单独确认

- tcp可靠数据传输

  和SR比较像，超时重传时间是RTT加权平均算出来的动态变化的，每次重传一个segment。

### 流量控制机制

速度匹配机制，发送方不能超过接收方的buffer

### 拥塞控制

表现：
分组丢失（路由器缓存溢出）
分组延迟过大（路由器缓存排队）
多跳结构的路由器组发生拥塞时，被drop的路由器的“上游”传输能力全部被浪费掉

- 吞吐率

	- 限制发送速率（拥塞窗口/RTT）

	  拥塞窗口（CongWin）：
	  动态调整以改变发送速率
	  反应所感知到的网络拥塞

	- 如何感知网络拥塞

	  loss事件=timeout或三个重复ACK，发生loss事件后降低发送速率

	- 如何调整发送速率

		- 加性增-乘性减（aimd）

		  谨慎的线性的增加发送速率（拥塞避免）发生loss事件后拥塞窗口减半

		- 慢启动（ss）

		  可用带宽可能远远高于初始速率，希望快速增长

		- 从慢启动状态切换为加性增阶段

		  当CongWin达到loss事件前值的一半时，拥塞窗口回到一个初始值，然后指数增长到loss事件前值的一半，最后再线性增长。reno改进版是拥塞窗口直接变成拥塞窗口的一半再线性增长而不是回到初值。其实这也有问题，拥塞窗口的判断是三个重复ACK的时候表示拥塞不是很严重，减半是合理的。发生timeout的时候表示拥塞已经很严重了，这时候需要直接让拥塞窗口回到初值

- 公平性

  TCP是具有公平性的，多媒体应用为了避免拥塞用udp，udp是不公平的（相对TCP而言）

## 网络应用

### http

- 非持久性连接

	- 网络响应时间为2个rtt+文件发送时间

	  rtt表示客户端发送一个很小的数据包到服务器并返回所经历的时间

	- 非持久性连接是串行操作 资源消耗大

- 持久性连接

  分为有流水机制的持久性连接和无流水机制的持久性连接。区别在于是否需要收到前一个响应之后再发送请求。有流水机制的持久性连接感觉上接近于滑动窗口机制。

- 请求消息和响应消息
- cookie和session

### 用于Email的smtp和pop3，IMAP等协议

### DNS（IP和域名的识别系统）

集中式的DNS存在单点失败问题，流量问题，距离问题，维护性问题。
区分迭代查询和递归查询。迭代查询可能需要本地域名服务器发送多条请求，递归查询只需要一条请求。

### P2P架构

- 相比于CS架构有更高的效率
- 文件分发

	- tracker：跟踪参与torrent的节点
	- torrent：交换同一个文件的文件块的节点组
	- 任意时刻不同节点持有文件的不同chunk集合
	- 索引的演变

	  最早是集中式节点，有单点失效问题，性能瓶颈，版权问题。
	  洪泛式查询：查询消息通过已有的TCP连接，阶段转发查询消息，查询命中的话利用反向路径发回查询节点。
	  层次式覆盖网络。每个节点要么是一个超级节点要么被分配一个超级节点。

### socket编程

- 面向传输层

  流式套接字
  数据报套接字

- 面向网络层

  原始套接字

- 复杂且无用的socketapi

## 网络安全

#不是说不重要，是我觉得用不到

### 基本属性

机密性，身份认证，信息完整性

### 密码学

- 对称密钥加密

  加解密都是一个密钥

- 公开密钥加密

### 加密方法

- 传统加密

  凯撒密码：用某个字母替代另一个字母
  单码替代密码：凯撒密码升级版，依然是简单加密，也容易破解
  多码替代加密，换位密码

- 现代加密技术

  针对二进制位进行操作

	- 对称加密

	  流密码和分组密码
	  挺难的，有个印象就好，需要的时候再看
	  数据加密标准（des）（98年就废弃了）（分组加密的一种）
	  RSA加密还是主流加密方式

	- 非对称加密

### 安全检验

身份认证，报文完整性，散列（哈希）

### 虚拟专用网络

功能：数据机密性保护，完整性认证，数据源身份认证，防重放攻击，访问控制

*XMind: ZEN - Trial Version*